<!-- ...保留原有内容... -->
  <script src="src/js/main.js"></script>
  <script src="src/js/test-packages.js"></script>
  <script src="src/js/test.js"></script>
  <script>
    // 励志名言轮播
    const quotes = [
      "你已经比昨天的自己更进一步了。",
      "不要小看每一次努力的力量。",
      "你是独一无二的，世界因为你而更加美好。",
      "每一个梦想的背后，都是不懈的坚持。",
      "遇见困难时，记住：你已经战胜过很多次了。",
      "你的存在本身就是一种意义。",
      "再小的光也能照亮黑暗。",
      "请勇敢地成为你自己。",
      "坚持是最浪漫的告白。",
      "不负热爱，不负自己。",
      "你现在的努力，是未来的种子。",
      "勇敢不是不害怕，而是即使害怕也继续向前。",
      "你的付出一定会被看到。",
      "不要着急，一切都在慢慢变好。",
      "最美的风景，总在前方。",
      "请相信，温柔和坚定可以并存。",
      "成长的过程，也值得骄傲。",
      "你已经很棒了，继续加油！",
      "今天的坚持，是明天的成就。"
    ];
    function rotateQuotes() {
      const quoteEl = document.getElementById("inspiration-quote");
      let index = 0;
      const showQuote = () => {
        quoteEl.style.opacity = 0;
        setTimeout(() => {
          quoteEl.textContent = quotes[index];
          quoteEl.style.opacity = 1;
          index = (index + 1) % quotes.length;
        }, 1000);
      };
      showQuote();
      setInterval(showQuote, 10000);
    }

    // 按维度随机抽取题目
    function getRandomQuestionsByDimension(questions, countPerDim = 10) {
      const dims = { EI: [], SN: [], TF: [], JP: [] };
      questions.forEach(q => {
        if (dims[q.dimension]) dims[q.dimension].push(q);
      });
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }
      let selected = [];
      for (const dim in dims) {
        if (dims[dim].length < countPerDim) return null;
        selected = selected.concat(shuffle(dims[dim]).slice(0, countPerDim));
      }
      return shuffle(selected);
    }

    // 转换test.js问题格式
    function transformQuestions(rawQuestions) {
      return rawQuestions.map(q => ({
        text: q.text,
        options: q.options,
        dimension: q.dimension
      }));
    }

    let currentQuestionIndex = 0;
    let answers = [];
    let testQuestions = [];

    document.addEventListener('DOMContentLoaded', function() {
      rotateQuotes();
      localStorage.setItem('testConfig', JSON.stringify({
        type: 'basic',
        questionCount: 40
      }));

      const startBtn = document.getElementById('start-test-btn');
      const testIntro = document.getElementById('test-intro');
      const testQuestionsDiv = document.getElementById('test-questions');
      const progressContainer = document.getElementById('test-progress-container');
      const encouragement = document.getElementById('encouragement');
      const questionText = document.getElementById('question-text');
      const questionOptions = document.getElementById('question-options');
      const nextBtn = document.getElementById('next-question');
      const prevBtn = document.getElementById('prev-question');
      const questionNumber = document.getElementById('question-number');
      const completionPercentage = document.getElementById('completion-percentage');
      const progressBar = document.getElementById('progress-bar');

      if (startBtn) {
        startBtn.addEventListener('click', function() {
          // 只用 test.js 的 window.questions
          let rawQuestions = [];
          if (window.questions && Array.isArray(window.questions) && window.questions.length >= 40) {
            rawQuestions = window.questions;
          } else {
            alert('无法加载测试题目，请稍后再试！');
            return;
          }
          // 按维度随机抽取每个维度10题
          const selected = getRandomQuestionsByDimension(rawQuestions, 10);
          if (selected && selected.length === 40) {
            testQuestions = transformQuestions(selected);
          } else {
            alert('无法加载测试题目，请稍后再试！');
            return;
          }
          currentQuestionIndex = 0;
          answers = new Array(testQuestions.length).fill(null);
          testIntro.classList.add('hidden');
          testQuestionsDiv.classList.remove('hidden');
          progressContainer.classList.remove('hidden');
          encouragement.classList.remove('hidden');
          showQuestion();
        });
      }

      if (nextBtn) {
        nextBtn.addEventListener('click', function() {
          const radios = document.querySelectorAll('input[name="question"]');
          let selected = false;
          let selectedValue = null;
          radios.forEach((radio, idx) => {
            if (radio.checked) {
              selected = true;
              selectedValue = idx;
            }
          });
          if (!selected) {
            alert('请选择一个答案后再继续');
            return;
          }
          answers[currentQuestionIndex] = selectedValue;
          if (currentQuestionIndex < testQuestions.length - 1) {
            currentQuestionIndex++;
            showQuestion();
          } else if (currentQuestionIndex === testQuestions.length - 1) {
            completeTest();
          } else {
            alert('无法加载测试题目，请稍后再试！');
          }
        });
      }

      if (prevBtn) {
        prevBtn.addEventListener('click', function() {
          if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            showQuestion();
          }
        });
      }

      function showQuestion() {
        const q = testQuestions[currentQuestionIndex];
        if (!q) {
          alert('无法加载测试题目，请稍后再试！');
          return;
        }
        questionText.textContent = `${currentQuestionIndex + 1}. ${q.text}`;
        questionOptions.innerHTML = `
          <label class="flex items-start space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-colors">
            <input type="radio" name="question" value="0" class="mt-1 text-green-600 focus:ring-green-500">
            <span class="flex-1">
              <span class="font-medium text-gray-900">${q.options[0]}</span>
            </span>
          </label>
          <label class="flex items-start space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-colors">
            <input type="radio" name="question" value="1" class="mt-1 text-green-600 focus:ring-green-500">
            <span class="flex-1">
              <span class="font-medium text-gray-900">${q.options[1]}</span>
            </span>
          </label>
        `;
        // 恢复之前的选择
        if (answers[currentQuestionIndex] !== null) {
          const radios = document.querySelectorAll('input[name="question"]');
          if (radios[answers[currentQuestionIndex]]) {
            radios[answers[currentQuestionIndex]].checked = true;
          }
        }
        // 更新进度条
        questionNumber.textContent = `问题 ${currentQuestionIndex + 1}/${testQuestions.length}`;
        const percent = Math.round((currentQuestionIndex + 1) / testQuestions.length * 100);
        completionPercentage.textContent = `${percent}%`;
        progressBar.style.width = `${percent}%`;
        // 按钮显示逻辑
        if (currentQuestionIndex === 0) {
          prevBtn.classList.add('hidden');
          nextBtn.textContent = '下一题';
        } else if (currentQuestionIndex === testQuestions.length - 1) {
          prevBtn.classList.remove('hidden');
          nextBtn.textContent = '完成测试';
        } else {
          prevBtn.classList.remove('hidden');
          nextBtn.textContent = '下一题';
        }
      }

      function completeTest() {
        if (answers.some(a => a === null)) {
          alert('请确保回答所有问题后再提交！');
          currentQuestionIndex = answers.findIndex(a => a === null);
          showQuestion();
          return;
        }
        // 计算分数
        let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        for (let i = 0; i < answers.length; i++) {
          const q = testQuestions[i];
          const ans = answers[i];
          if (q.dimension === 'EI') {
            if (ans === 0) scores.E++; else scores.I++;
          } else if (q.dimension === 'SN') {
            if (ans === 0) scores.S++; else scores.N++;
          } else if (q.dimension === 'TF') {
            if (ans === 0) scores.T++; else scores.F++;
          } else if (q.dimension === 'JP') {
            if (ans === 0) scores.J++; else scores.P++;
          }
        }
        const type =
          (scores.E >= scores.I ? 'E' : 'I') +
          (scores.S >= scores.N ? 'S' : 'N') +
          (scores.T >= scores.F ? 'T' : 'F') +
          (scores.J >= scores.P ? 'J' : 'P');
        localStorage.setItem('mbtiType', type);
        localStorage.setItem('mbtiScores', JSON.stringify(scores));
        localStorage.setItem('testAnswers', JSON.stringify(answers));
        localStorage.setItem('testCompleted', 'true');
        window.location.href = 'result.html?type=basic';
      }
    });
  </script>
</body>
</html>
