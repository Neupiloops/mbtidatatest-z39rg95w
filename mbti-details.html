<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MBTI 详细信息</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="font-sans text-gray-800 bg-gray-50 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow-sm py-4">
    <div class="max-w-4xl mx-auto px-4 flex justify-center items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="16" x2="12" y2="12" />
        <line x1="12" y1="8" x2="12.01" y2="8" />
      </svg>
      <span class="ml-2 text-xl font-bold text-gray-900">智能MBTI</span>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-grow max-w-4xl mx-auto px-4 py-12">
    <div class="flex justify-between items-center mb-8">
      <h2 id="title" class="text-3xl font-bold text-blue-700">加载中...</h2>
      <button onclick="window.close()" class="text-2xl text-gray-600 hover:text-red-500 transition-colors">×</button>
    </div>
    <div id="content" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
    <div id="summary-card" class="mt-10 bg-blue-50 border border-blue-200 rounded-lg p-6 shadow-md"></div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-4">
    <div class="max-w-4xl mx-auto px-4 text-center text-gray-400">
      © 2025 智能导航 - 专业MBTI测试. 保留所有权利.
    </div>
  </footer>

  <script>
    // Build cards for sections
    function buildCards(data) {
      const names = {
        childhood: "童年时期",
        student: "学生时期",
        career: "职场冷知识",
        relationship: "情感关系",
        retirement: "退休时期",
        cosmic: "宇宙级冷知识"
      };

      return Object.entries(names)
        .filter(([k]) => data[k])
        .map(([key, label]) => {
          const card = data[key];
          return `
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
              <div class="bg-gradient-to-r from-blue-50 to-blue-100 px-5 py-3 rounded-t-lg">
                <h4 class="text-lg font-semibold text-blue-600">${label}</h4>
              </div>
              <div class="p-5">
                <p class="text-base text-gray-800 mb-3">${card.fact}</p>
                <p class="text-sm text-gray-600 pl-4 border-l-2 border-blue-200">${card.example}</p>
              </div>
            </div>`;
        }).join('');
    }

    // Fallback data
    const fallbackData = {
      ESTP: {
        childhood: {
          fact: "ESTP小孩是“幼儿园的开心果”，总能带动全班气氛，喜欢组织游戏、表演节目，是小伙伴们的社交中心。他们对身边人的情绪极为敏感，看到谁不开心会立刻想办法逗笑对方。遇到冲突时，往往选择用幽默化解，而不是正面硬刚。",
          example: "有个ESTP小朋友看到同桌因为玩具丢了闷闷不乐，立刻自编自演一段“玩具侦探剧”，不仅让同桌破涕为笑，还带动全班加入“寻宝行动”，老师说：“他就是班里的小太阳。”"
        },
        student: {
          fact: "ESTP在学生时代是“班级气氛组”，擅长组织活动、表演节目和调解同学矛盾。他们善于察言观色，能迅速发现同学的情绪变化，并用实际行动提供帮助。对枯燥理论课兴趣有限，但在艺术、体育和社交活动中如鱼得水。",
          example: "某ESTP学生在班级文艺汇演前一天发现节目单太单调，现场即兴策划“互动小游戏”，带动全班嗨翻天，老师感叹：“有他在，活动永远不冷场。”"
        },
        career: {
          fact: "ESTP在职场中是“团队氛围制造机”，以高超的社交能力和适应力著称，善于用魅力和幽默化解尴尬和压力。他们喜欢自由、变化多的工作环境，讨厌一成不变和过度条条框框的岗位。ESTP在销售、活动策划、客户服务等需要人际互动的岗位表现尤为突出。",
          example: "某ESTP员工在公司年会自告奋勇当主持，现场即兴连线、带动气氛，连平时最严肃的老板都被逗笑，大家说：“有他在，连加班都能变成派对。”"
        },
        relationship: {
          fact: "ESTP在感情中极度热情和浪漫，喜欢用惊喜和实际行动表达爱意。他们擅长制造浪漫氛围，喜欢和伴侣一起体验新鲜事物。遇到矛盾时倾向于回避冲突，更愿意用温柔和幽默化解尴尬。",
          example: "某ESTP女友不会写长篇情书，但会在纪念日当天突然带男友去体验热气球，结束后还自制一段vlog记录全程，男友感叹：“和她在一起，每天都像综艺节目。”"
        },
        retirement: {
          fact: "退休后的ESTP依然活跃在社交圈，喜欢参与社区活动、志愿服务或带动邻里娱乐。他们会把退休生活过成“快乐俱乐部”，用自己的热情感染身边每一个人。",
          example: "有位退休ESTP大爷在小区组织“广场舞大赛”，自己带头编舞、拉赞助，最后全社区都加入，大家说：“他让退休生活变成了嘉年华。”"
        },
        cosmic: {
          fact: "ESTP的本质是“人类版快乐发电机”--用Se（外倾感觉）捕捉生活的每一份美好，用Fi（内倾情感）真诚表达自我，用Te（外倾思考）偶尔高效解决实际问题，再用Ni（内倾直觉）……偶尔灵光一现。他们总能在最平凡的日子里点燃快乐，被称为“现实世界的气氛担当”。",
          example: "有个ESTP朋友聚会时突然提议“即兴才艺秀”，自己带头唱跳，最后全场嗨到停不下来，朋友们都说：“他在的地方永远不会无聊。”"
        },
        summary: {
          self: "如果你是ESTP：这些冷知识是不是让你忍不住想马上拉个群组织活动？",
          others: "如果你认识ESTP：现在你懂他们为什么总能让身边充满欢笑和活力了。"
        }
      },
      INTJ: {
        childhood: {
          fact: "INTJ小孩喜欢独自玩策略游戏，热衷于设计复杂规则和计划。",
          example: "某INTJ小孩为玩伴设计了一套‘太空冒险’游戏规则，连大人都惊叹其逻辑性。"
        },
        student: {
          fact: "INTJ学生偏好自学深奥科目，对理论研究充满热情。",
          example: "某INTJ学生自学编程，开发了一个简单的应用，老师推荐他参加科技竞赛。"
        },
        career: {
          fact: "INTJ在职场擅长制定长期战略计划，追求效率和目标实现。",
          example: "某INTJ员工为公司设计五年发展计划，赢得高层一致认可。"
        },
        relationship: {
          fact: "INTJ在感情中谨慎表达情感，只对亲密的人敞开心扉。",
          example: "某INTJ在纪念日为伴侣写了一封深情但简洁的信，感动对方。"
        },
        retirement: {
          fact: "退休后的INTJ专注于财务自由和个人兴趣，如研究或写作。",
          example: "某INTJ退休后出版了一本关于战略规划的书，广受好评。"
        },
        cosmic: {
          fact: "INTJ热衷于思考宇宙和存在的意义，常研究哲学或天文学。",
          example: "某INTJ朋友在聚会中分享宇宙膨胀理论，引发大家深思。"
        },
        summary: {
          self: "如果你是INTJ：这些冷知识是否让你想规划更宏大的目标？",
          others: "如果你认识INTJ：他们看似冷漠，但内心充满深思和热情。"
        }
      }
    };

    // Fetch JSON
    async function tryFetch(paths) {
      for (const path of paths) {
        console.log(`Fetching: ${path}`);
        try {
          const res = await fetch(path);
          console.log(`Status: ${res.status} ${res.statusText}`);
          if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          }
          const data = await res.json();
          console.log(`Success: ${path}`);
          return data;
        } catch (err) {
          console.error(`Failed: ${path} - ${err.message}`);
        }
      }
      throw new Error('无法加载 JSON 文件');
    }

    // Render data
    function renderData(data) {
      console.log('Rendering data for type:', type);
      const d = data[type];
      if (!d) {
        throw new Error(`数据不存在: ${type}`);
      }
      document.getElementById('title').textContent = `${type} - 深入解读`;
      document.getElementById('content').innerHTML = buildCards(d);
      document.getElementById('summary-card').innerHTML = d.summary ?
        `<h4 class="text-lg font-semibold text-blue-700 mb-3">总结</h4>
         <p class="text-base text-gray-700 mb-2">${d.summary.self}</p>
         <p class="text-sm text-gray-600">${d.summary.others}</p>` : '';
    }

    // Main function
    async function main() {
      console.log('Starting main function');
      const urlParams = new URLSearchParams(window.location.search);
      const type = urlParams.get('type');

      if (!type) {
        console.error('No MBTI type provided in URL');
        document.getElementById('title').textContent = '错误';
        document.getElementById('content').innerHTML = '<p class="text-red-500 text-center text-base">未提供 MBTI 类型</p>';
        return;
      }

      const possiblePaths = [
        './mbtifactsmore.json',
        '/mbtifactsmore.json'
      ];

      try {
        const data = await tryFetch(possiblePaths);
        renderData(data);
      } catch (err) {
        console.error('Fetch error:', err.message);
        document.getElementById('title').textContent = '加载失败';
        document.getElementById('content').innerHTML = `
          <p class="text-red-500 text-center text-base">无法加载内容: ${err.message}</p>
          <p class="text-gray-600 text-center text-sm mt-2">使用备用数据展示示例内容。</p>`;
        const d = fallbackData[type] || fallbackData['INTJ'];
        renderData(d);
      }
    }

    // Run main function
    main();
  </script>
</body>
</html>
